<!DOCTYPE HTML>
<html lang="pt" dir="ltr">
	<head>

		<title>Manutenção de Ativos</title>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />

		<link rel="stylesheet" type="text/css" href="/epc/res-plc/geral.css" />
		
		<link rel="stylesheet" type="text/css" href="/epc/res-plx/cmis/client/css/plximage.css" />
		
		<script type="text/javascript" src="/epc/res-mvp/javascript/jquery/jquery-1.5.js"></script>
		<script type="text/javascript" src="/epc/res-mvp/javascript/jquery/jquery.json-2.2.js"></script>
		<script type="text/javascript" src="/epc/res-plc/jquery/jquery.starRating.js"></script>

		<script type="text/javascript" src="/epc/res-mvp/javascript/pagebus/pagebus.js"></script>

		<script type="text/javascript" src="/epc/res-mvp/plc.mvp.js"></script>
		
		<script type="text/javascript" src="/epc/res-plx/cmis/client/javascript/ajaxupload.js"></script>
		
		<script type="text/javascript" src="/epc/res-plx/ria-mvp-library/plc-tags.js"></script>
		<script type="text/javascript" src="/epc/res-plx/ria-mvp-library/plc-datedesc.js"></script>
		<script type="text/javascript" src="/epc/res-plx/ria-mvp-library/plc-fileimage.js"></script>
		<script type="text/javascript" src="/epc/res-plx/ria-mvp-library/plc-link.js"></script>
		
		
	</head>
	<body>
		
		<div class="page">
			<form action="assetman">
			
				<!-- Mensagem erro -->
				<div class="plc-msg" id="plc-mensagem">
					<div class="ui-corner-all plc-msg-erro" style="display:none"></div>
					<div class="ui-corner-all plc-msg-sucesso" style="display:none"></div>
					<div class="ui-corner-all plc-msg-advertencia" style="display:none"></div>
					<div class="ui-corner-all plc-msg-livre" style="display:none"></div>
				</div>

				<!-- Barra de ações -->
				<div class="header-bar">

					<div id="stars" class="stars"></div>

					<div class="buttons">
						<button class="button" value="list">&lt; Lista</button>
						<span class="separator"></span>
						<button class="button" value="new">Novo</button>
						<span class="separator"></span>
						<button class="button save" value="save">Gravar</button>
						<button class="button save" value="delete">Delete</button>
						<span class="separator"></span>
						<button class="button" value="">A&ccedil;&otilde;es</button>
						<span class="separator"></span>
						<button class="button link" value="link"></button>
						<button class="button print" value="print"></button>
					</div>

				</div>

				<input type="hidden" name="id" value="" />
				<!-- Campos de versão -->
				<input type="hidden" name="assetman_version" value="" />

				<fieldset>
					<legend>Ativo</legend>

					<div class="trow">
						<div class="column">
							<span class="label"><label for="assetman_id">Cód.:</label></span>
							<span class="input"><input type="text" maxlength="50" name="assetman_id" value="" /></span>
						</div>
						<div class="column">
							<span class="label"><label for="assetman_name">Nome:</label></span>
							<span class="input"><input type="text" maxlength="50" name="assetman_name" value="" /></span>
						</div>
						<div class="column">
							<span class="label"><label for="assetman_assetVersion">Situação:</label></span>
							<span class="input"><input type="text" maxlength="50" name="assetman_assetVersion" value="" /></span>
						</div>
					</div>

					<div class="row">
						<span class="label"><label for="assetman_description">Descrição.:</label></span>
						<span class="input"><input type="text" maxlength="50" name="assetman_description" value="" /></span>
					</div>
					<div class="drow">
						<div class="leftcolumn">
							<span class="label"><label for="assetman_primaryType_id">Tipo Primário.:</label></span>
							<span class="input"><select name="assetman_primaryType_id" data-lookup="AssetArtifactTypePrimary"><option value="">[Selecione]</option></select></span>
						</div>
						<div class="rightcolumn">
							<span class="label"><label for="assetman_assetDomain_id">Domínio:</label></span>
							<span class="input"><select name="assetman_assetDomain_id" data-lookup="AssetDomain"><option value="">[Selecione]</option></select></span>
						</div>
					</div>
					<div class="trow">
						<div class="column">
							<span class="label"><label for="assetman_variability">Variabilidade:</label></span>
							<span class="input"><select name="assetman_variability" data-lookup="AssetVariability"><option value="">[Selecione]</option></select></span>
						</div>
						<div class="column">
							<span class="label"><label for="assetman_granularity">Granularidade:</label></span>
							<span class="input"><select name="assetman_granularity" data-lookup="AssetGranularity"><option value="">[Selecione]</option></select></span>
						</div>
						<div class="column">
							<span class="label"><label for="assetman_articulation">Articulação:</label></span>
							<span class="input"><select name="assetman_articulation" data-lookup="AssetArticulation"><option value="">[Selecione]</option></select></span>
						</div>
					</div>

					<div class="drow">
						<div class="leftcolumn">
							<span class="label"><label for="assetman_idImage">Imagem.:</label></span>
							<span class="input"><input type="text" maxlength="50" name="assetman_idImage" value="" data-plw="plc-fileimage"/></span>
						</div>
						<div class="rightcolumn">
							<span class="label"><label for="assetman_urlReference">Cadastro.:</label></span>
							<span class="input"><input type="text" maxlength="50" name="assetman_urlReference" value="" /></span>
						</div>
					</div>

					<div class="row">
						<span class="label"><label for="assetman_tags">Tags.:</label></span>
						<span class="input"><input type="text" maxlength="50" name="assetman_tags" value="" /></span>
					</div>
					
					<div class="row">
						<span class="label"><label for="assetman_author">Autor:</label></span>
						<span class="input"><input type="text" maxlength="50" name="assetman_author" data-plc="plc-link"  value="" /></span>
					</div>

				</fieldset>
			</form>
		</div>
		
		<script type="text/javascript" id="avaliar:feedback" avaliar="S">
		
		plc.bus.subscribe("form.list.assetman", function(){
			window.location.replace( plc.contextPath + "/res-mvp/asset.sel.html" );
		});
		
		$(function() {
			var msgTotalVotos = '';
			var useCase = 'teste';
			var app = 'teste';
			var idRegistro='123';

			function resultTransform(data){
				if (data){
					if (idRegistro!=""){
						data = data.split('|');
						return {
							permissao: data[0] == 'true'
							,media: Math.round(parseFloat(data[1])) || 0
							,total: parseInt(data[2]) || 0
						};
					}
				}
				return false;
			}

			function atualizaTotal(total) {
				if (typeof total != 'undefined')
					$('#'+useCase+'-total').html(msgTotalVotos + total);
				else
					$('#'+useCase+'-total').empty();
			}

			function onClick(options, value){
				options.customParams.urlDestino = urlFB + "&rate=" + value;
			}

			function sucessCallback(resultado){
				atualizaTotal(resultado.total);
			}

			function resultCallback(data){

				var resultado = resultTransform(data);
				resultado.rating = resultado.media;
				resultado.clickable = resultado.permissao == true;
				resultado.hoverable = resultado.permissao == true;

				return resultado;
			}

			var urlProxy = plc.contextPath+"/soa/plc/proxy";

			var urlFB = 'http://www.powerlogic.com.br/jcpmonitor/soa/app/feedback?app=teste3&useCase=teste&login=igo&idRegistro=233';

			$.ajax({
				url: urlProxy
				,type: "GET"
				,data: {urlDestino: urlFB}
				,cache: false
				,success: function(data){

					var resultado = resultTransform(data);

					if (resultado){
						$('#stars').starRating({
							basicImage : plc.contextPath+'/res-plc/midia/jquery/star.gif',
							ratedImage : plc.contextPath+'/res-plc/midia/jquery/star_hover.gif',
							hoverImage : plc.contextPath+'/res-plc/midia/jquery/star_blue.gif',
							ratingUrl : urlProxy,
							click : onClick,
							result : resultCallback,
							sucess : sucessCallback,
							showNumber : false,
							rating : resultado.media,
							customParams : {urlDestino: urlFB},
							clickable : true,
							hoverable : true,
							paramId : null,
							paramValue : null
						});
						atualizaTotal(resultado.total);
					}
				}
			});
		});

		</script>

	</body>
</html>
